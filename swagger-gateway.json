swagger: "2.0"
info:
  title: Gateway API
  description: Piazza Core Services API
  version: "0.1.0"
  contact: 
    name: Patrick Doody
    email: patrick.doody@rgi-corp.com
    url: https://github.com/venicegeo/venice/wiki
host: pz-gateway.stage.geointservices.io
schemes:
  - https
consumes:
  - application/json
produces:
  - application/json
paths:
  /job/{jobId}:
    get:
      summary: Get Job Status
      description: "Fetches the Status for a single Piazza Job."
      parameters:
        - name: jobId
          in: path
          description: "ID of the Job to Fetch"
          required: true
          type: string
      tags:
        - Job
      responses:
        200:
          description: "Information regarding the requested Job. At bare minimum, this will contain the Job ID of the Job that has been spawned as a result of the POSTed message. If more information is available, such as Status, it will also be included."
          schema:
            $ref: '#/definitions/JobStatusResponse'
        default:
          description: "Unexpected Error"
          schema:
            $ref: '#/definitions/ErrorResponse'
    put:
      summary: Repeat Job
      description: "Repeats a previously submitted Job. This will clone the original Job, and run it again with identical parameters, using the requesting users authentication in the new Job."
      parameters:
        - name: jobId
          in: path
          description: "ID of the Job to Repeat"
          required: true
          type: string
      tags:
        - Job
      responses:
        200:
          description: "A new Job ID that corresponds to the cloned Job in Piazza."
          schema:
            $ref: '#/definitions/JobResponse'
        default:
          description: Unexpected Error.
          schema:
            $ref: '#/definitions/ErrorResponse'
    delete:
      summary: Abort Job
      description: "Cancels a Running Job. If the Job is already completed in some way, then cancellation will not occur."
      parameters:
        - name: jobId
          in: path
          description: ID of the Job to Cancel
          required: true
          type: string
      tags:
        - Job
      responses:
        200:
          description: "The Job has requested to be cancelled. This may take some time, as the process may not be in an easily cancelled state at the time the request is made."
          schema:
            $ref: '#/definitions/JobResponse'
        default:
          description: "Unexpected Error"
          schema:
            $ref: '#/definitions/ErrorResponse'
  /data:
    post:
      summary: Load Data into Piazza
      description: "Loads data into the Piazza Core metadata holdings. Piazza can either host the data, or reflect an external location where the data is stored. Data must be loaded into Piazza before core components such as the Service Controller, or other external services, are able to consume that data."
      parameters:
        - name: data
          in: body
          description: "The description, location, and metadata for the Data to be loaded into Piazza."
          required: true
          schema:
            $ref: '#/definitions/IngestJob'
      tags:
        - Data
      responses:
        200:
          description: "The ID of the Job created to handle the Loading of the Data."
          schema:
            $ref: '#/definitions/JobResponse'
        default:
          description: "Unexpected Error"
          schema:
            $ref: '#/definitions/ErrorResponse'
  /data/{dataId}:
    get:
      summary: Get Metadata for Loaded Data
      description: "Reads all metadata for a Data item that has been previously loaded into Piazza."
      parameters:
        - name: dataId
          in: path
          description: "ID of the Data item to pull Metadata for."
          required: true
          type: string
      tags:
        - Data
      responses:
        200:
          description: "Metadata describing the Data Item that matches the specified Data ID. Includes release metadata, and spatial metadata, etc."
          schema:
            $ref: '#/definitions/DataResource'
        default:
          description: "Unexpected Error"
          schema:
            $ref: '#/definitions/ErrorResponse'
definitions:
  ErrorResponse:
    description: "The standard response object for an unexpected error within the Piazza core."
    type: object
    required:
      - message
      - origin
    properties:
      message:
        description: "The high-level description of the error message. May contain debug information useful for technical debugging."
        type: string
      origin:
        description: "The name of the component the error originated from."
        type: string
  JobResponse:
    type: object
    description: "An asynchronous response from the Gateway where a Job has been created, with the provided Job ID. This Job ID can then be queried for Job status to determine when the Job has succeeded, or to track its progress."
    required:
      - jobId
    properties:
      jobId:
        description: "The ID of the Job that has been created from the request."
        type: string
  JobStatusResponse:
    type: object
    description: "Represents the status of a Job in the Piazza system; either running or completed. Contains information such as progress, time remaining, errors encountered, Job results, or general Job Status."
    required:
      - status
      - jobType
      - submittedBy
    properties:
      result:
        description: "A reference to the Result of the Job. This could be a Resource ID, or a Service ID, in certain cases. Or perhaps an error if the Job encountered an error during processing."
        type: string
      status:
        description: "The status of the Job. Submitted, Running, Success, Error, or Failure."
        type: string
      jobType:
        description: "Polymorphically describes the information defining what actions this Job should take."
        type: string
      submittedBy:
        description: "The name of the user who submitted the Job."
        type: string
      progress:
        $ref: '#/definitions/JobProgress'
  JobProgress:
    type: object
    description: "Defines Job Progress."
    properties:
      percentComplete:
        description: "The percentage complete for the Job, in whole numbers, out of 100 percent"
        type: integer
        format: int32
      timeRemaining:
        description: "The last value for the Time Remaining as reported by the processor of this Job."
        type: string
      timeSpent:
        description: "The amount of time spent by the processor of this Job, according to that processor."
        type: string
  DataResource:
    type: object
    description: "Defines a Data Resource in the Piazza core data holdings. Includes information as to the data's format, location, spatial content, and metadata."
    properties:
      dataType:
        description: "Polymorphically defines the information specific to this Data Resource, based on its format."
        type: string
      metadata:
        description: "The metadata for this resource, such as classification level or availability."
        type: string
      spatialMetadata:
        description: "Spatial metadata, applicable for spatial data, including EPSG code and bounding box."
        type: string
  IngestJob:
    type: object
    description: "Defines the payload for requesting Data to be loaded into Piazza."
    allOf:
      - $ref: '#/definitions/DataResource'
      - required:
        - host
        properties:
          host:
            description: "Dictates if Piazza should internally host the data or not. If set to true, then the data will be stored in Piazza's data holdings. If false, then Piazza will point to the location of the data, but will not store the data internally."
            type: boolean



















